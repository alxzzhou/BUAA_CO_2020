# P7计时器说明文档

## 一、状态转移图

![d4d9e54a5ace38f2dcd47fd886ea2db](C:\Users\alxzz\Desktop\d4d9e54a5ace38f2dcd47fd886ea2db.png)

## 二、计时模式

​		在模式0下：**初值寄存器值被自动加载至计数器。**当计数器倒计数为 0 后，计数器停止计数，此时控制寄存器中的使能 Enable 自动变为 0。**当使能 Enable 被设置为 1 后，初值寄存器值再次被加载至计数器， 计数器重新启动倒计数。** 模式 0 通常用于产生定时中断。例如，为操作系统的时间片调度机制提供定 时。**模式 0 下的中断信号将持续有效，直至控制寄存器中的中断屏蔽位被设置为 0。**

​		在模式1下：**当计数器倒计数为 0 后，初值寄存器值被自动加载至计数器，计数器继续倒计数。** 模式 1 通常用于产生周期性脉冲。例如，可以用模式 1 产生步进电机所需的 步进控制信号。不同于模式 0，模式 1 下计数器每次计数循环中只产生一周期的中断信号。

​		 模式0计时结束后，一直保持中断，直到en或IM被修改，模式1计时结束后，中断一个周期，再重新计数。可以理解为中断保持的逻辑不同。

## 三、操作规范

-   在任意状态当中，count寄存器都是只读寄存器，任意对count寄存器的写操作都会被mips判定为异常。
-   在任意状态当中，对ctrl，preset和count寄存器合法的读写操作都是按字读写，任意按字节或半字读写的操作都会被判定为异常。
-   在各个模式当中的合法寄存器操作见**二、计时模式**。